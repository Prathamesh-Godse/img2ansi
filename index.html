<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANSI Colored ASCII Art Converter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            background: linear-gradient(90deg, #ff8a00, #e52e71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .description {
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .converter {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .input-section {
            flex: 1;
            min-width: 300px;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        
        .output-section {
            flex: 2;
            min-width: 300px;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            overflow: auto;
            max-height: 80vh;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #fdbb2d;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            background: #333;
            border-radius: 4px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #fdbb2d;
            cursor: pointer;
        }
        
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #fdbb2d;
        }
        
        select {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            background: #333;
            color: white;
            border: 1px solid #555;
        }
        
        .range-value {
            display: inline-block;
            width: 40px;
            text-align: right;
            color: #fff;
        }
        
        button {
            background: linear-gradient(90deg, #ff8a00, #e52e71);
            color: #fff;
            border: none;
            padding: 12px 20px;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
            margin-top: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
        }
        
        #image-input {
            display: none;
        }
        
        .upload-btn {
            background: #3498db;
            display: block;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .upload-btn:hover {
            background: #2980b9;
        }
        
        #image-preview {
            max-width: 100%;
            margin-top: 15px;
            border-radius: 5px;
            display: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        #ascii-art {
            white-space: pre;
            font-size: 8px;
            line-height: 8px;
            letter-spacing: 0;
            background: #000;
            padding: 10px;
            border-radius: 5px;
            overflow: auto;
            font-family: 'Courier New', monospace;
        }
        
        .download-btn {
            background: linear-gradient(90deg, #00c6ff, #0072ff);
            margin-top: 15px;
        }
        
        .download-btn:hover {
            background: linear-gradient(90deg, #00b4eb, #0066cc);
        }
        
        .instructions {
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        
        .instructions h2 {
            margin-bottom: 15px;
            color: #fdbb2d;
        }
        
        .instructions ol {
            margin-left: 20px;
            line-height: 1.6;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
        
        .color-sample {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .color-box {
            width: 20px;
            height: 20px;
            border: 1px solid #fff;
            border-radius: 3px;
        }
        
        .ansi-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .converter {
                flex-direction: column;
            }
            
            #ascii-art {
                font-size: 6px;
                line-height: 6px;
            }
        }
        
        @media (max-width: 480px) {
            #ascii-art {
                font-size: 4px;
                line-height: 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ANSI Colored ASCII Art Converter</h1>
            <p class="description">Convert any image to colored ASCII art with ANSI escape codes. The output can be saved as a text file that preserves colors in terminals that support ANSI colors.</p>
        </header>
        
        <div class="converter">
            <div class="input-section">
                <h2>Input</h2>
                <label for="image-input" class="upload-btn">Choose Image</label>
                <input type="file" id="image-input" accept="image/*">
                
                <div class="form-group">
                    <label for="width">Output Width: <span id="width-value" class="range-value">100</span> characters</label>
                    <input type="range" id="width" min="50" max="200" value="100">
                </div>
                
                <div class="form-group">
                    <label for="contrast">Contrast: <span id="contrast-value" class="range-value">1</span></label>
                    <input type="range" id="contrast" min="0.5" max="2" step="0.1" value="1">
                </div>
                
                <div class="form-group">
                    <label for="brightness">Brightness: <span id="brightness-value" class="range-value">1</span></label>
                    <input type="range" id="brightness" min="0.5" max="2" step="0.1" value="1">
                </div>
                
                <div class="form-group">
                    <label for="color-intensity">Color Intensity: <span id="color-intensity-value" class="range-value">1</span></label>
                    <input type="range" id="color-intensity" min="0.5" max="2" step="0.1" value="1">
                </div>
                
                <div class="form-group">
                    <label for="invert">Invert Colors:</label>
                    <input type="checkbox" id="invert">
                </div>
                
                <div class="form-group">
                    <label for="color-mode">Color Mode:</label>
                    <select id="color-mode">
                        <option value="ansi256">ANSI 256 Colors</option>
                        <option value="ansi16">ANSI 16 Colors</option>
                        <option value="grayscale">Grayscale</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="background">Background:</label>
                    <select id="background">
                        <option value="dark">Dark</option>
                        <option value="light">Light</option>
                        <option value="transparent">Transparent</option>
                    </select>
                </div>
                
                <button id="convert-btn">Convert to ANSI ASCII</button>
                <button id="download-btn" class="download-btn">Download ANSI Text File</button>
                
                <img id="image-preview" alt="Image preview">
                
                <div class="ansi-info">
                    <p><strong>Note:</strong> ANSI colors will display correctly in terminals that support ANSI escape codes (e.g., Linux/Mac terminals, Windows Terminal, ConEmu).</p>
                </div>
            </div>
            
            <div class="output-section">
                <h2>ANSI Colored ASCII Art Output</h2>
                <div id="ascii-art">Your ANSI colored ASCII art will appear here...</div>
            </div>
        </div>
        
        <div class="instructions">
            <h2>How to Use</h2>
            <ol>
                <li>Click "Choose Image" to select an image from your device</li>
                <li>Adjust the output width to control the size of the ASCII art</li>
                <li>Use contrast, brightness, and color intensity sliders to fine-tune the output</li>
                <li>Select color mode: ANSI 256 Colors (recommended), ANSI 16 Colors, or Grayscale</li>
                <li>Choose a background option that matches your terminal</li>
                <li>Click "Convert to ANSI ASCII" to generate your ASCII art</li>
                <li>Use "Download ANSI Text File" to save the result as a text file with ANSI color codes</li>
                <li>View the text file in a terminal that supports ANSI colors to see the colors</li>
            </ol>
            <p>For best results, use images with good contrast and vibrant colors.</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const imageInput = document.getElementById('image-input');
            const imagePreview = document.getElementById('image-preview');
            const widthSlider = document.getElementById('width');
            const widthValue = document.getElementById('width-value');
            const contrastSlider = document.getElementById('contrast');
            const contrastValue = document.getElementById('contrast-value');
            const brightnessSlider = document.getElementById('brightness');
            const brightnessValue = document.getElementById('brightness-value');
            const colorIntensitySlider = document.getElementById('color-intensity');
            const colorIntensityValue = document.getElementById('color-intensity-value');
            const invertCheckbox = document.getElementById('invert');
            const colorModeSelect = document.getElementById('color-mode');
            const backgroundSelect = document.getElementById('background');
            const convertBtn = document.getElementById('convert-btn');
            const downloadBtn = document.getElementById('download-btn');
            const asciiArt = document.getElementById('ascii-art');
            
            let originalImage = null;
            let ansiOutput = "";
            
            // Update slider value displays
            widthSlider.addEventListener('input', () => {
                widthValue.textContent = widthSlider.value;
            });
            
            contrastSlider.addEventListener('input', () => {
                contrastValue.textContent = contrastSlider.value;
            });
            
            brightnessSlider.addEventListener('input', () => {
                brightnessValue.textContent = brightnessSlider.value;
            });
            
            colorIntensitySlider.addEventListener('input', () => {
                colorIntensityValue.textContent = colorIntensitySlider.value;
            });
            
            // Handle image selection
            imageInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    originalImage = new Image();
                    originalImage.onload = function() {
                        imagePreview.style.display = 'block';
                        imagePreview.src = event.target.result;
                        asciiArt.innerHTML = 'Image loaded. Click "Convert to ANSI ASCII" to generate.';
                    };
                    originalImage.src = event.target.result;
                };
                reader.readAsDataURL(file);
            });
            
            // Convert image to ASCII
            convertBtn.addEventListener('click', function() {
                if (!originalImage) {
                    asciiArt.innerHTML = 'Please select an image first.';
                    return;
                }
                
                asciiArt.innerHTML = 'Converting...';
                
                // Use setTimeout to allow the UI to update before the conversion
                setTimeout(() => {
                    const width = parseInt(widthSlider.value);
                    const contrast = parseFloat(contrastSlider.value);
                    const brightness = parseFloat(brightnessSlider.value);
                    const colorIntensity = parseFloat(colorIntensitySlider.value);
                    const invert = invertCheckbox.checked;
                    const colorMode = colorModeSelect.value;
                    const background = backgroundSelect.value;
                    
                    const result = convertImageToAnsiASCII(originalImage, width, contrast, brightness, colorIntensity, invert, colorMode, background);
                    asciiArt.innerHTML = result.html;
                    ansiOutput = result.ansi;
                }, 100);
            });
            
            // Download ASCII art
            downloadBtn.addEventListener('click', function() {
                if (!ansiOutput) {
                    return;
                }
                
                const element = document.createElement('a');
                element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(ansiOutput));
                element.setAttribute('download', 'ansi-ascii-art.txt');
                element.style.display = 'none';
                document.body.appendChild(element);
                element.click();
                document.body.removeChild(element);
            });
            
            // Convert RGB to ANSI 256 color code
            function rgbToAnsi256(r, g, b) {
                if (r === g && g === b) {
                    if (r < 8) return 16;
                    if (r > 248) return 231;
                    return Math.round(((r - 8) / 247) * 24) + 232;
                }
                
                const ansi = 16 +
                    (36 * Math.round(r / 255 * 5)) +
                    (6 * Math.round(g / 255 * 5)) +
                    Math.round(b / 255 * 5);
                
                return ansi;
            }
            
            // Convert RGB to ANSI 16 color code
            function rgbToAnsi16(r, g, b) {
                const value = Math.max(r, g, b) > 128 ? 
                    (Math.max(r, g, b) > 192 ? 15 : 7) : 
                    (Math.max(r, g, b) > 64 ? 8 : 0);
                
                if (r === g && g === b) return value;
                
                let color = value;
                
                if (r > 128) color |= 1; // Red
                if (g > 128) color |= 2; // Green
                if (b > 128) color |= 4; // Blue
                
                return color;
            }
            
            // The main conversion function with ANSI color
            function convertImageToAnsiASCII(image, width, contrast, brightness, colorIntensity, invert, colorMode, background) {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Calculate height to maintain aspect ratio
                const ratio = image.height / image.width;
                const height = Math.floor(width * ratio * 0.5); // Adjust for character aspect ratio
                
                canvas.width = width;
                canvas.height = height;
                
                // Draw image to canvas
                ctx.drawImage(image, 0, 0, width, height);
                
                // Get image data
                const imageData = ctx.getImageData(0, 0, width, height);
                const data = imageData.data;
                
                // Character set from dark to light
                const charset = invert 
                    ? '@%#*+=-:. ' // Dark to light
                    : ' .:-=+*#%@'; // Light to dark
                
                let htmlOutput = '';
                let ansiOutput = '';
                
                // Process each pixel
                for (let y = 0; y < height; y++) {
                    for (let x = 0; x < width; x++) {
                        const index = (y * width + x) * 4;
                        let r = data[index];
                        let g = data[index + 1];
                        let b = data[index + 2];
                        
                        // Apply color intensity
                        r = Math.min(255, Math.max(0, r * colorIntensity));
                        g = Math.min(255, Math.max(0, g * colorIntensity));
                        b = Math.min(255, Math.max(0, b * colorIntensity));
                        
                        // Calculate brightness with adjustments
                        let pixelBrightness = (0.3 * r + 0.59 * g + 0.11 * b) / 255;
                        
                        // Apply contrast and brightness
                        pixelBrightness = Math.pow(pixelBrightness, contrast) * brightness;
                        pixelBrightness = Math.max(0, Math.min(1, pixelBrightness));
                        
                        // Map to character
                        const charIndex = Math.floor(pixelBrightness * (charset.length - 1));
                        const char = charset[charIndex];
                        
                        // Convert to ANSI color
                        let ansiColorCode;
                        let htmlColor;
                        
                        if (colorMode === 'grayscale') {
                            const gray = Math.round((r + g + b) / 3);
                            ansiColorCode = `38;5;${rgbToAnsi256(gray, gray, gray)}`;
                            htmlColor = `rgb(${gray}, ${gray}, ${gray})`;
                        } else if (colorMode === 'ansi16') {
                            ansiColorCode = `3${rgbToAnsi16(r, g, b)}`;
                            htmlColor = `rgb(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)})`;
                        } else { // ansi256
                            ansiColorCode = `38;5;${rgbToAnsi256(r, g, b)}`;
                            htmlColor = `rgb(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)})`;
                        }
                        
                        // Add to ANSI output
                        ansiOutput += `\x1b[${ansiColorCode}m${char}\x1b[0m`;
                        
                        // Add to HTML output for preview
                        htmlOutput += `<span style="color: ${htmlColor}">${char}</span>`;
                    }
                    ansiOutput += '\n';
                    htmlOutput += '\n';
                }
                
                // Reset ANSI at the end
                ansiOutput += '\x1b[0m';
                
                return {
                    html: htmlOutput,
                    ansi: ansiOutput
                };
            }
        });
    </script>
</body>
</html>
